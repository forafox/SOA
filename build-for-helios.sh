#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ –ì–µ–ª–∏–æ—Å (WildFly)

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—É—é —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –ì–µ–ª–∏–æ—Å..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "build-frontend.sh" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# 1. –°–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å –±—ç–∫–µ–Ω–¥–æ–º
echo "üì¶ –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
./build-frontend.sh

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"
    exit 1
fi

# 2. –°–æ–±–∏—Ä–∞–µ–º WAR —Ñ–∞–π–ª
echo "üî® –®–∞–≥ 2: –°–±–æ—Ä–∫–∞ WAR —Ñ–∞–π–ª–∞..."
cd backend-oscars
./gradlew clean war

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ WAR —Ñ–∞–π–ª–∞"
    exit 1
fi

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
WAR_FILE="build/libs/backend-oscars-0.0.1-SNAPSHOT.war"
if [ -f "$WAR_FILE" ]; then
    echo "‚úÖ WAR —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: $WAR_FILE"
    echo "üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(du -h "$WAR_FILE" | cut -f1)"
    echo ""
    echo "üéØ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ –ì–µ–ª–∏–æ—Å!"
    echo "üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª: $(pwd)/$WAR_FILE"
    echo "üåê –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 8080"
else
    echo "‚ùå WAR —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

cd ..
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ WAR —Ñ–∞–π–ª –Ω–∞ –ì–µ–ª–∏–æ—Å"
echo "2. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –µ–≥–æ –≤ WildFly (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º)"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ –∞–¥—Ä–µ—Å—É: http://your-domain:8080/"
