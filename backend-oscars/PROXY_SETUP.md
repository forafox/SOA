# Настройка проксирования API

Эта документация описывает реализацию проксирования запросов к фильмам на внешний сервис.

## Обзор

Система настроена для перенаправления запросов от клиента на внешний сервис:

- **Клиентский запрос**: `GET https://localhost:8133/api/movies?page=1&size=20`
- **Перенаправление на**: `https://localhost:37861/SOA-1.0-SNAPSHOT/api/movies?page=1&size=20`

## Компоненты

### 1. ProxyController
**Файл**: `src/main/java/com/jellyone/oscars/controller/ProxyController.java`

Контроллер перехватывает все запросы к `/api/movies/**` и перенаправляет их на внешний сервис.

**Поддерживаемые HTTP методы**:
- GET - получение данных
- POST - создание ресурсов
- PUT - обновление ресурсов  
- DELETE - удаление ресурсов

**Функции**:
- Автоматическое проксирование query параметров
- Поддержка request body для POST/PUT запросов
- Логирование всех запросов и ответов
- Обработка ошибок соединения

### 2. WebClientConfig 
**Файл**: `src/main/java/com/jellyone/oscars/config/WebClientConfig.java`

Обновлена конфигурация WebClient для поддержки:
- HTTPS соединений
- Самоподписанных SSL сертификатов
- Настройка таймаутов соединения

### 3. Конфигурация приложения
**Файл**: `src/main/resources/application.yaml`

Добавлена новая конфигурация:
```yaml
movies:
  api:
    base-url: http://localhost:37860/SOA-1.0-SNAPSHOT/api    # Первый сервис
    proxy-url: https://localhost:37861/SOA-1.0-SNAPSHOT/api  # Второй сервис (проксируемый)
```

### 4. Swagger документация
**Файл**: `src/main/java/com/jellyone/oscars/config/SwaggerConfig.java`

Добавлена документация для:
- Группа API "Movies Proxy" 
- Автоматическая генерация документации для всех proxy эндпоинтов
- Описание параметров и ответов

## Использование

### Swagger UI
Доступ к документации API: `http://localhost:8080/swagger-ui.html`

В Swagger UI будут доступны две группы API:
1. **oscars** - операции с Оскарами
2. **movies-proxy** - проксируемые операции с фильмами

### Примеры запросов

```bash
# Получить список фильмов
GET http://localhost:8080/api/movies?page=1&size=20

# Получить конкретный фильм
GET http://localhost:8080/api/movies/123

# Создать фильм
POST http://localhost:8080/api/movies
Content-Type: application/json
{
  "name": "Test Movie",
  "genre": "DRAMA"
}
```

## Логирование

Все proxy запросы логируются с информацией:
- HTTP метод и URL запроса
- Целевой URL на внешнем сервисе
- Статус выполнения
- Ошибки соединения (если есть)

## Безопасность

- Настроена поддержка HTTPS с InsecureTrustManager для работы с самоподписанными сертификатами
- Таймауты соединения настроены на 10 секунд
- Автоматическое закрытие соединений после запроса

## Обработка ошибок

- При ошибках соединения возвращается HTTP 500
- При отсутствии данных возвращается HTTP 404  
- Все ошибки логируются для диагностики
